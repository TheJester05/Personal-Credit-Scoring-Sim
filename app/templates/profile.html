<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C-URCredit - My Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg bg-primary rounded-pill m-3 px-4">
    <div class="container-fluid d-flex justify-content-between align-items-center">
      <span class="navbar-brand text-white fw-bold fs-3">C–URCredit</span>
      <div class="navbar-nav flex-row gap-4">
        <a class="nav-link text-white" href="/index">HOME</a>
        <a class="nav-link text-white" href="/profile">MY PROFILE</a>
        <a class="nav-link text-white" href="/simulator">SIMULATOR</a>
        <a class="nav-link text-white" href="/score">SCORE</a>
        <a class="nav-link text-white" href="/tips">TIPS</a>
      </div>
    </div>
  </nav>

  <!-- Profile Section -->
 <main>
  <div class="container bg-light rounded-4 p-5 profile-container">
    <h1 class="fw-bold text-primary-emphasis mb-4">My Profile</h1>

    <form method="POST" action="/submit-profile">
      <!-- GENERAL INFO -->
      <h6 class="fw-bold text-primary">GENERAL INFORMATION</h6>
      <div class="row mb-4">
        <div class="col-md-4">
          <label class="form-label">FIRST NAME:</label>
          <input type="text" name="first_name" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">LAST NAME:</label>
          <input type="text" name="last_name" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">EMAIL:</label>
          <input type="email" name="email" class="form-control rounded-pill input-outline">
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-4">
          <label class="form-label">AGE:</label>
          <input type="number" name="age" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">EMPLOYMENT STATUS:</label>
          <select name="employment_status" class="form-select rounded-pill input-outline">
            <option disabled selected>Select...</option>
            <option>Employed</option>
            <option>Self-employed</option>
            <option>Unemployed</option>
            <option>Student</option>
          </select>
        </div>
      </div>

      <!-- FINANCIAL PROFILE -->
      <h6 class="fw-bold text-primary">FINANCIAL PROFILE</h6>
      <div class="row mb-4">
        <div class="col-md-4">
          <label class="form-label">MONTHLY INCOME:</label>
          <input type="text" name="income" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">TOTAL CREDIT LIMIT:</label>
          <input type="text" name="credit_limit" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">CURRENT DEBT:</label>
          <input type="text" name="current_debt" class="form-control rounded-pill input-outline">
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-4">
          <label class="form-label">LATE PAYMENTS:</label>
          <input type="text" name="late_payments" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">LOAN HISTORY:</label>
          <input type="text" name="loan_history" class="form-control rounded-pill input-outline">
        </div>
        <div class="col-md-4">
          <label class="form-label">CREDIT UTILIZATION (%):</label>
          <input type="number" name="utilization" class="form-control rounded-pill input-outline">
        </div>
      </div>

      <div class="text-end">
        <button type="submit" class="btn btn-primary rounded-pill px-4">Submit</button>
      </div>
    </form>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const email = sessionStorage.getItem('email');
    if (email) {
      const simulatorLink = document.querySelector('a[href="/simulator"]');
      const scoreLink = document.querySelector('a[href="/score"]');
      
      if (simulatorLink) {
        simulatorLink.href = `/simulator?email=${encodeURIComponent(email)}`;
      }
      if (scoreLink) {
        scoreLink.href = `/score?email=${encodeURIComponent(email)}`;
      }
    }
  });
</script>
  <!-- Footer -->
  <footer class="text-center bg-primary text-white py-2 mt-5">
    ©C–URCREDIT 2025
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', async function () {
    const email = sessionStorage.getItem('email');
    if (!email) {
      alert("You're not logged in.");
      window.location.href = "/login";
      return;
    }

    document.querySelector('input[name="email"]').value = email;

    try {
      const res = await fetch(`/get-profile/${email}`);
      if (res.ok) {
        const data = await res.json();
        for (const key in data) {
          const input = document.querySelector(`[name="${key}"]`);
          if (input) input.value = data[key];
        }
      }
    } catch (err) {
      console.error("Error loading profile:", err);
    }
  });
</script>

</body>
</html>
